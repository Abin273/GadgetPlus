<section class="content-main">
  <div class="content-header">
    <div>
      <h2 class="content-title card-title">Categories</h2>
    </div>
    <div>
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
        data-bs-whatever="@getbootstrap">
        Add Category +
      </button>
    </div>
  </div>
  <hr />
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md-12">
          <div class="table-responsive">
            <table class="table table-hover" id="categoryTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% for( let i=0; i < categories.length; i++ ) { %>

                  <tr>
                    <td>
                      <%= i+1 %>
                    </td>
                    <td><b>
                        <%= categories[i].name %>
                      </b></td>
                    <td>
                      <%= categories[i].description %>
                    </td>
                    <td width="20%">
                      <button class="btn btn-danger btn-sm btn-brand rounded font-sm mt-15"
                        data-id="<%= categories[i]._id %>" id="editButton">
                        Edit
                      </button>

                      <% if (categories[i].status) { %>
                        <button id="delete-category<%= categories[i]._id %>" class="btn btn-sm btn-success rounded font-sm mt-15"
                          onclick="deleteACategory('<%= categories[i]._id %>') ">
                          Listed
                        </button>
                      <% } else { %>
                        <button id="delete-category<%= categories[i]._id %>" class="btn btn-sm btn-danger rounded font-sm mt-15"
                          onclick="deleteACategory('<%= categories[i]._id %>') ">
                          Unlisted
                        </button>

                      <% } %>

                    </td>
                  </tr>
                  <% } %>
              </tbody>
            </table>
          </div>
        </div>
        <!-- .col// -->
      </div>
      <!-- .row // -->
    </div>
    <!-- card body .// -->
  </div>
  <!-- card .// -->
</section>
<!-- content-main end// -->

<!-- Modal -->

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/admin/add-productCategory" method="post">
          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">Category Name</label>
            <input type="text" class="form-control" name="categoryName" id="recipient-name" />
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Category Description</label>
            <textarea class="form-control" name="categoryDescription" id="message-text"></textarea>
          </div>
          <div>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn ms-auto d-block btn-primary">
              Create category
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editCAtegory" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <% for( let i=0; i < categories.length; i++ ) { %>
          <form action="/admin/add-productCategory" method="post">
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Category Name</label>
              <input type="text" class="form-control" value="<%= categories[i].name %>" name="categoryName"
                id="recipient-name" />
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">Category Description</label>
              <textarea class="form-control" value="<%= categories[i].description %>" name="categoryDescription"
                id="message-text"></textarea>
            </div>
            <div>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Close
              </button>
              <button type="submit" class="btn ms-auto d-block btn-primary">
                Create category
              </button>
            </div>
          </form>
          <% } %>
      </div>
    </div>
  </div>
</div>

<script>
  function deleteACategory(categoryId) {
    swal("Are you sure you want to delete this", {
      buttons: ["cancel", "ok"],
    }).then((res) => {
      if (res) {
        $.ajax({
          url: "/admin/delete-productCategory/" + categoryId,
          type: "get",
        }).done((res) => {
          if (res) {
            swal("successfull", `${res.message}`, "success")
              .then(() => {

                if(res.listed){
                  const button=document.getElementById('delete-category'+categoryId);
                  document.getElementById('delete-category'+categoryId).classList.remove('btn-danger');
                  document.getElementById('delete-category'+categoryId).classList.add('btn-success');
                  button.innerHTML="Listed"

                }else{
                  const button=document.getElementById('delete-category'+categoryId);
                  document.getElementById('delete-category'+categoryId).classList.add('btn-danger');
                  document.getElementById('delete-category'+categoryId).classList.remove('btn-success');
                  button.innerHTML="UnListed"
               
                }
                console.log(res.listed);
                // location.reload()
              })
          }
        });
      }
    });
  }

  // $("#editButton").click((e) => {
  //   swal("Are you sure you want to delete this", {
  //     buttons: ["cancel", "ok"],

  //   }).then((res) => {

  //     if (res) {
  //       let id = $(this).data("id");
  //       console.log(id);
  //       $.ajax({
  //         url: "/admin/edit-productCategory/" + id,
  //         type:'get'
  //       })
  //       .done((res)=>{
  //         console.log("========================");
  //       })
  //     }

  //   });
  // });
</script>